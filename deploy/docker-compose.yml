# AiKv Cluster Deployment (6 nodes: 3 masters, 3 replicas)
# Generated by aikv-tool

version: '3.8'

services:
  aikv1:
    image: aikv:cluster
    container_name: aikv1
    hostname: aikv1
    command: ["--config", "/app/config/aikv.toml"]
    ports:
      - "6379:6379"
      - "50051:50051"
    volumes:
      - aikv1-data:/app/data
      - aikv1-logs:/app/logs
      - ./aikv-node1.toml:/app/config/aikv.toml:ro
    environment:
      - RUST_LOG=info
      - AIKV_NODE_ID=n1
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "PING"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - aikv-cluster

  aikv2:
    image: aikv:cluster
    container_name: aikv2
    hostname: aikv2
    command: ["--config", "/app/config/aikv.toml"]
    ports:
      - "6380:6380"
      - "50052:50052"
    volumes:
      - aikv2-data:/app/data
      - aikv2-logs:/app/logs
      - ./aikv-node2.toml:/app/config/aikv.toml:ro
    environment:
      - RUST_LOG=info
      - AIKV_NODE_ID=n2
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6380", "PING"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - aikv-cluster

  aikv3:
    image: aikv:cluster
    container_name: aikv3
    hostname: aikv3
    command: ["--config", "/app/config/aikv.toml"]
    ports:
      - "6381:6381"
      - "50053:50053"
    volumes:
      - aikv3-data:/app/data
      - aikv3-logs:/app/logs
      - ./aikv-node3.toml:/app/config/aikv.toml:ro
    environment:
      - RUST_LOG=info
      - AIKV_NODE_ID=n3
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6381", "PING"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - aikv-cluster

  aikv4:
    image: aikv:cluster
    container_name: aikv4
    hostname: aikv4
    command: ["--config", "/app/config/aikv.toml"]
    ports:
      - "6382:6382"
      - "50054:50054"
    volumes:
      - aikv4-data:/app/data
      - aikv4-logs:/app/logs
      - ./aikv-node4.toml:/app/config/aikv.toml:ro
    environment:
      - RUST_LOG=info
      - AIKV_NODE_ID=n4
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6382", "PING"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - aikv-cluster

  aikv5:
    image: aikv:cluster
    container_name: aikv5
    hostname: aikv5
    command: ["--config", "/app/config/aikv.toml"]
    ports:
      - "6383:6383"
      - "50055:50055"
    volumes:
      - aikv5-data:/app/data
      - aikv5-logs:/app/logs
      - ./aikv-node5.toml:/app/config/aikv.toml:ro
    environment:
      - RUST_LOG=info
      - AIKV_NODE_ID=n5
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6383", "PING"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - aikv-cluster

  aikv6:
    image: aikv:cluster
    container_name: aikv6
    hostname: aikv6
    command: ["--config", "/app/config/aikv.toml"]
    ports:
      - "6384:6384"
      - "50056:50056"
    volumes:
      - aikv6-data:/app/data
      - aikv6-logs:/app/logs
      - ./aikv-node6.toml:/app/config/aikv.toml:ro
    environment:
      - RUST_LOG=info
      - AIKV_NODE_ID=n6
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6384", "PING"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - aikv-cluster

volumes:
  aikv1-data:
  aikv1-logs:
  aikv2-data:
  aikv2-logs:
  aikv3-data:
  aikv3-logs:
  aikv4-data:
  aikv4-logs:
  aikv5-data:
  aikv5-logs:
  aikv6-data:
  aikv6-logs:

networks:
  aikv-cluster:
    name: aikv-cluster-network
    driver: bridge
